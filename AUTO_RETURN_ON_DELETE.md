# ๐ ุจุงุฒฺฏุดุช ุฎูุฏฺฉุงุฑ ูพุฑูููโูุง ุจู ุงูุจุงุฑ ููฺฏุงู ุญุฐู ูพุฑูฺู

## ฺุฑุง ุงู ูฺฺฏุ

ููุช ฺฉ ูพุฑูฺู ุฑู ุญุฐู ูโฺฉูุฏุ ูพุฑูููโูุง ฺฉู ุจุฑุง ุงูู ูพุฑูฺู ุงุฒ ุงูุจุงุฑ ฺฉุณุฑ ุดุฏู ุจูุฏูุ ุจุงุฏ ุจู ุงูุจุงุฑ ุจุฑฺฏุฑุฏู. ูฺฏุฑูู ููุฌูุฏ ุงูุจุงุฑ ุงุดุชุจุงู ูุดู ู ุดูุง ุถุฑุฑ ูโฺฉูุฏ.

---

## ๐ ูุซุงู ูุงูุน

### ูุจู ุงุฒ ุงู ูฺฺฏ โ

```
1. ูพุฑูฺู "ุขูุง ุงุญูุฏ" ุงุฌุงุฏ ุดุฏ
2. ูุญุงุณุจู ุจุฑุด: ูุงุฒ ุจู 5 ุดุงุฎู ูุฑู ูุณ
3. ฺฉุณุฑ ุงุฒ ุงูุจุงุฑ: ููุฌูุฏ 100 โ 95 ุดุงุฎู โ
4. ูพุฑูฺู ุญุฐู ุดุฏ โ
5. ููุฌูุฏ ุงูุจุงุฑ: ููฺูุงู 95 ุดุงุฎู! โ๏ธ
   โ 5 ุดุงุฎู ุงุฒ ุฏุณุช ุฑูุช!
```

### ุจุนุฏ ุงุฒ ุงู ูฺฺฏ โ

```
1. ูพุฑูฺู "ุขูุง ุงุญูุฏ" ุงุฌุงุฏ ุดุฏ
2. ูุญุงุณุจู ุจุฑุด: ูุงุฒ ุจู 5 ุดุงุฎู ูุฑู ูุณ
3. ฺฉุณุฑ ุงุฒ ุงูุจุงุฑ: ููุฌูุฏ 100 โ 95 ุดุงุฎู โ
4. ูพุฑูฺู ุญุฐู ุดุฏ ๐๏ธ
   โ ุณุณุชู 5 ุดุงุฎู ุฑู ุจู ุงูุจุงุฑ ุจุฑฺฏุฑุฏููุฏ
   โ ููุฌูุฏ: 95 โ 100 ุดุงุฎู โ
   โ ุฏุฑ ุชุงุฑุฎฺู ุซุจุช ุดุฏ โ
```

---

## ๐ง ฺุทูุฑ ฺฉุงุฑ ูโฺฉููุ

### ูุฑุญูู 1: ููุช ูพุฑูฺู ุญุฐู ูุดู

ุณุณุชู **ูุจู ุงุฒ ุญุฐู ูพุฑูฺู**:

1. **ุฌุณุชุฌู ูโฺฉูู** ุฏุฑ ุฌุฏูู `inventory_deductions` ฺฉู ุงู ูพุฑูฺู ฺู ฺุฒูุง ฺฉุณุฑ ฺฉุฑุฏู
2. **ุจุฑูโฺฏุฑุฏููู** ูุฑ ูพุฑููู ุฑู ุจู ุงูุจุงุฑ (ุจู `inventory_items` ุงุถุงูู ูุดู)
3. **ุซุจุช ูโฺฉูู** ุฏุฑ ุชุงุฑุฎฺู ุงูุจุงุฑ (`inventory_logs`) ุจุง ููุน `return_on_delete`
4. **ุจุนุฏ ูพุฑูฺู ุฑู ุญุฐู ูโฺฉูู**

### ูุฑุญูู 2: ุซุจุช ุฏุฑ ุชุงุฑุฎฺู

ูุฑ ุจุงุฒฺฏุดุช ุฏุฑ ูุงฺฏ ุงูุจุงุฑ ุจุง ุงู ูุดุฎุตุงุช ุซุจุช ูุดู:

| ููุฏ | ููุฏุงุฑ |
|------|-------|
| `change_type` | `return_on_delete` |
| `quantity` | ุชุนุฏุงุฏ ุดุงุฎูโูุง ุจุฑฺฏุดุช |
| `description` | "ุจุงุฒฺฏุดุช X ุดุงุฎู ุจู ุฎุงุทุฑ ุญุฐู ูพุฑูฺู: ูุงู ูพุฑูฺู" |

---

## ๐ป ุชุบุฑุงุช ฺฉุฏ

### ุชุงุจุน `delete_project_db` (ุฏุฑ `database.py`)

ุชุบุฑ ุงุตู ุฏุฑ ุงู ุชุงุจุน ุงูุฌุงู ุดุฏู:

```python
def delete_project_db(project_id):
    # ูุจู ุงุฒ ุญุฐูุ ฺฉุณุฑูุง ุฑู ูพุฏุง ูโฺฉูู
    cursor.execute("""
        SELECT d.profile_type_id, d.quantity_deducted, pt.name as profile_name
        FROM inventory_deductions d
        JOIN profile_types pt ON d.profile_type_id = pt.id
        WHERE d.project_id = ?
    """, (project_id,))
    
    deductions = cursor.fetchall()
    
    for ded in deductions:
        # ุจู ุงูุจุงุฑ ุจุฑูโฺฏุฑุฏููู
        cursor.execute("""
            UPDATE inventory_items 
            SET quantity = quantity + ?, last_updated = CURRENT_TIMESTAMP 
            WHERE profile_type_id = ?
        """, (ded['quantity_deducted'], ded['profile_type_id']))
        
        # ุฏุฑ ูุงฺฏ ุซุจุช ูโฺฉูู
        cursor.execute("""
            INSERT INTO inventory_logs 
            (profile_type_id, change_type, quantity, description)
            VALUES (?, 'return_on_delete', ?, ?)
        """, (
            ded['profile_type_id'], 
            ded['quantity_deducted'], 
            f"ุจุงุฒฺฏุดุช {ded['quantity_deducted']} ุดุงุฎู ุจู ุฎุงุทุฑ ุญุฐู ูพุฑูฺู"
        ))
    
    # ุญุงูุง ูพุฑูฺู ุฑู ุญุฐู ูโฺฉูู
    # ... ุจูู ฺฉุฏ ุญุฐู
```

---

## ๐งช ุชุณุช ฺฉุฑุฏู

### ุฑูุด 1: ุชุณุช ุฏุณุช

1. ฺฉ ูพุฑูฺู ุงุฌุงุฏ ฺฉูุฏ
2. ูุญุงุณุจู ุจุฑุด ฺฉูุฏ
3. ุงุฒ ุงูุจุงุฑ ฺฉุณุฑ ฺฉูุฏ โ ููุฌูุฏ ฺฉู ูุดู
4. ูพุฑูฺู ุฑู ุญุฐู ฺฉูุฏ
5. ุจู ุฏุงุดุจูุฑุฏ ุงูุจุงุฑ ุจุฑุฏ โ ููุฌูุฏ ุงูุฒุงุด ุงูุชู โ
6. ุจู ุชุงุฑุฎฺู ุงูุจุงุฑ ุจุฑุฏ โ ฺฉ ุฑฺฉูุฑุฏ `return_on_delete` ุซุจุช ุดุฏู โ

### ุฑูุด 2: ุงุณฺฉุฑูพุช ุจุฑุฑุณ

```bash
python check_deductions.py
```

ุงู ุงุณฺฉุฑูพุช ูุดูู ูุฏู:
- ฺู ูพุฑูฺูโูุง ฺฉุณุฑ ุฏุงุฑู
- ููุฌูุฏ ูุนู ฺูุฏุฑู
- ุจุนุฏ ุงุฒ ุญุฐู ููุฌูุฏ ฺูุฏุฑ ูุดู

---

## ๐ ุณูุงุฑููุง ูุฎุชูู

### ุญุงูุช 1: ูพุฑูฺู ุจุฏูู ฺฉุณุฑ
```
ูพุฑูฺู ุงุฌุงุฏ ุดุฏ ูู ูฺ ฺฉุณุฑ ูุฏุงุดุชู
โ ุญุฐู ูุนููู
โ ูฺ ฺุฒ ุจู ุงูุจุงุฑ ุจุฑููโฺฏุฑุฏู
```

### ุญุงูุช 2: ูพุฑูฺู ุจุง ฺฉ ููุน ูพุฑููู
```
ูพุฑูฺู: 5 ุดุงุฎู ูุฑู ูุณ ฺฉุณุฑ ุดุฏู
โ ุญุฐู ูพุฑูฺู
โ 5 ุดุงุฎู ูุฑู ูุณ ุจู ุงูุจุงุฑ ุจุฑูโฺฏุฑุฏู
```

### ุญุงูุช 3: ูพุฑูฺู ุจุง ฺูุฏ ููุน ูพุฑููู
```
ูพุฑูฺู:
  - 5 ุดุงุฎู ูุฑู ูุณ ฺฉุณุฑ ุดุฏู
  - 3 ุดุงุฎู ุชูฺูุจ ุฏุงุฑ ฺฉุณุฑ ุดุฏู
โ ุญุฐู ูพุฑูฺู
โ 5 ุดุงุฎู ูุฑู ูุณ + 3 ุดุงุฎู ุชูฺูุจ ุฏุงุฑ ุจู ุงูุจุงุฑ ุจุฑูโฺฏุฑุฏู
```

---

## โ๏ธ ูฺฉุงุช ููู

### 1๏ธโฃ ุชุถูู ฺฉูพุงุฑฺฺฏ ุฏุชุง
- ููู ุนููุงุช ุฏุฑ ฺฉ ุชุฑุงฺฉูุด ุงูุฌุงู ูุดู
- ุงฺฏู ูุดฺฉู ูพุด ุจุงุฏุ ููู ฺุฒ Rollback ูุดู
- ููุฌูุฏ ุงูุจุงุฑ ููุดู ุฏุฑุณุช ูโูููู

### 2๏ธโฃ ุณุงุฒฺฏุงุฑ ุจุง ุฏุชุงุจุณโูุง ูุฏู
- ุงฺฏู ุฌุฏูู `inventory_deductions` ูุฌูุฏ ูุฏุงุดุชู ุจุงุดูุ ุฎุทุง ููุฏู
- ููุท ฺฉ Warning ฺุงูพ ูุดู ู ุงุฏุงูู ูุฏู

### 3๏ธโฃ ูุงฺฏ ูุงุจู ุฑุฏุงุจ
- ููู ุจุงุฒฺฏุดุชโูุง ุฏุฑ `inventory_logs` ุซุจุช ูุดู
- ูโุชููุฏ ุจุจูุฏ ฺฉุ ฺ ุจุฑฺฏุดุชู

### 4๏ธโฃ ููุงููฺฏ ุจุง CASCADE
- ุฑฺฉูุฑุฏ ฺฉุณุฑ ุฏุฑ `inventory_deductions` ุฎูุฏฺฉุงุฑ ูพุงฺฉ ูุดู
- ูู ูุง ูุจู ุงุฒ ุงููุ ููุฌูุฏ ุฑู ุจุฑูโฺฏุฑุฏููู

---

## ๐ฏ ูุฒุงุง ุงู ุฑูุด

โ **ููุฌูุฏ ุฏุฑุณุช ูโูููู** - ูพุฑูููโูุง ุงุฒ ุฏุณุช ููุฑู  
โ **ูุงุจู ุฑุฏุงุจ** - ููู ฺุฒ ุฏุฑ ุชุงุฑุฎฺู ุซุจุช ูุดู  
โ **ุฎูุฏฺฉุงุฑ** - ฺฉุงุฑุจุฑ ูุงุฒ ุจู ฺฉุงุฑ ุงุถุงูู ูุฏุงุฑู  
โ **ุงูู** - ุฏุฑ ุชุฑุงฺฉูุด ุงูุฌุงู ูุดู  
โ **ูุงุถุญ** - ุฏุฑ ูุงฺฏ ูุดุฎุตู ฺุฑุง ุจุฑฺฏุดุชู  

---

## ๐ฑ ูุดุงูุฏู ุฏุฑ ุฑุงุจุท ฺฉุงุฑุจุฑ

### ุฏุงุดุจูุฑุฏ ุงูุจุงุฑ
ุจุนุฏ ุงุฒ ุญุฐู ูพุฑูฺูุ ููุฌูุฏ ุงูุฒุงุด ุงูุชู ุฑู ูโุจูุฏ.

### ุชุงุฑุฎฺู ุงูุจุงุฑ
ฺฉ ุฑฺฉูุฑุฏ ุฌุฏุฏ ุจุง ุงู ูุดุฎุตุงุช:

```
ููุน ุชุบุฑ: ุจุงุฒฺฏุดุช ุจู ุฎุงุทุฑ ุญุฐู ูพุฑูฺู
ูพุฑููู: ูุฑู ูุณ ูุฏู
ููุฏุงุฑ: +5 ุดุงุฎู
ุชูุถุญุงุช: ุจุงุฒฺฏุดุช 5 ุดุงุฎู ุจู ุฎุงุทุฑ ุญุฐู ูพุฑูฺู: ุขูุง ุงุญูุฏ
ุชุงุฑุฎ: 2025-12-30 08:30:15
```

---

## ๐ ูุงูโูุง ูุฑุชุจุท

- `database.py` โ ุชุงุจุน `delete_project_db`
- `inventory_logs` โ ุฌุฏูู ุซุจุช ุชุงุฑุฎฺู
- `inventory_deductions` โ ุฌุฏูู ุฑุฏุงุจ ฺฉุณุฑูุง
- `inventory_items` โ ุฌุฏูู ููุฌูุฏ ุงูุจุงุฑ

---

**ูุชุฌู:** ุญุงูุง ูโุชููุฏ ุฎุงูุชูู ุฑุงุญุช ุจุงุดู ฺฉู ููุช ฺฉ ูพุฑูฺู ุฑู ุญุฐู ูโฺฉูุฏุ ูพุฑูููโูุง ุจู ุงูุจุงุฑ ุจุฑูโฺฏุฑุฏู ู ููุฌูุฏ ุงุดุชุจุงู ููุดู! ๐

