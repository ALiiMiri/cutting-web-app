# 🛡️ راهنمای سیستم بکاپ

## چیست؟
سیستم بکاپ به شما اجازه می‌دهد نسخه‌های پشتیبان از دیتابیس خود بگیرید و در صورت نیاز به آن‌ها برگردید.

---

## چگونه استفاده کنم؟

### 1️⃣ مشاهده صفحه مدیریت بکاپ
- از صفحه اصلی، روی دکمه **"🛡️ مدیریت بکاپ"** کلیک کنید.
- تمام بکاپ‌های موجود را مشاهده خواهید کرد.

### 2️⃣ ایجاد بکاپ دستی
- روی دکمه **"🔄 ایجاد بکاپ جدید"** کلیک کنید.
- بکاپ جدید با تاریخ و زمان فعلی ساخته می‌شود.

### 3️⃣ بکاپ خودکار (قبل از کارهای مهم)
سیستم **خودکار** در این موارد بکاپ می‌گیرد:
- ✅ قبل از **حذف پروژه**
- ✅ قبل از **ویرایش گروهی درها** (Batch Edit)
- ✅ قبل از **کسر موجودی انبار**

یعنی اگر اشتباه کردید، همیشه یک بکاپ از قبل آن کار دارید!

### 4️⃣ بازگردانی (Restore)
- روی دکمه **"↩️ بازگردانی"** کنار هر بکاپ کلیک کنید.
- پیغام تایید می‌آید.
- **مهم:** قبل از بازگردانی، یک بکاپ امنیتی از وضعیت فعلی گرفته می‌شود.
- بعد از بازگردانی، برنامه را ببندید و دوباره باز کنید.

### 5️⃣ دانلود بکاپ
- روی دکمه **"⬇️ دانلود"** کلیک کنید.
- فایل بکاپ روی کامپیوترتان ذخیره می‌شود.
- این فایل را می‌توانید در جای امن (Google Drive, USB و...) نگه دارید.

### 6️⃣ حذف بکاپ
- روی دکمه **"🗑️ حذف"** کلیک کنید.
- بکاپ برای همیشه حذف می‌شود.

### 7️⃣ پاکسازی بکاپ‌های قدیمی
- روی دکمه **"🧹 پاکسازی بکاپ‌های قدیمی"** کلیک کنید.
- تمام بکاپ‌های قدیمی‌تر از **7 روز** حذف می‌شوند.

---

## ⚠️ نکات مهم

### 1. چه زمانی بکاپ بگیرم؟
- **قبل از هر کار مهم** (مثلاً قبل از پاک کردن چند پروژه)
- **هر روز** یک بار (مثلاً آخر روز کاری)
- **قبل از تست کارهای جدید**

### 2. بکاپ‌ها کجا ذخیره می‌شوند؟
- در پوشه `backups/` کنار برنامه
- نام هر بکاپ: `backup_20251231_235959.db`

### 3. چند تا بکاپ نگه دارم؟
- سیستم خودکار بکاپ‌های قدیمی‌تر از 7 روز را حذف نمی‌کند (شما باید دستی حذف کنید).
- پیشنهاد: **7-14 بکاپ** (یک هفته تا دو هفته اخیر)

### 4. بکاپ بزرگ می‌شود؟
- بله! هر بکاپ یک کپی کامل از دیتابیس است.
- اگر دیتابیس 10MB باشد، هر بکاپ هم 10MB است.
- بنابراین بکاپ‌های خیلی قدیمی را حذف کنید.

### 5. اگر برنامه در حال کار باشد چه؟
- مشکلی ندارد! سیستم از روش **امن SQLite** استفاده می‌کند.
- بکاپ حتی وقتی کاربران دارند کار می‌کنند هم درست است.

### 6. بعد از Restore چه کنم؟
- برنامه را **ببندید و دوباره باز کنید**.
- مطمئن شوید همه چیز درست کار می‌کند.

---

## 🆘 اگر مشکلی پیش آمد؟

### بکاپ نمی‌گیرد؟
- مطمئن شوید پوشه `backups/` وجود دارد (خودکار ساخته می‌شود).
- اگر خطای "دسترسی" می‌گیرید، مطمئن شوید برنامه اجازه نوشتن دارد.

### بازگردانی کار نمی‌کند؟
- مطمئن شوید **همه پنجره‌های برنامه بسته** هستند.
- اگر خطا می‌گیرید، بکاپ ممکن است خراب باشد.

### بکاپ گم شد؟
- بکاپ‌ها در پوشه `backups/` هستند.
- اگر فایل وجود دارد ولی در لیست نیست، برنامه را ببندید و باز کنید.

---

## 📚 اطلاعات فنی (برای برنامه‌نویسان)

### فایل‌های سیستم بکاپ
- **backup_manager.py**: کد اصلی مدیریت بکاپ
- **templates/backup_manager.html**: رابط کاربری
- **backups/**: پوشه ذخیره بکاپ‌ها

### توابع مهم
- `create_backup(reason, user, metadata)`: ایجاد بکاپ
- `restore_backup(filename)`: بازگردانی
- `list_backups()`: لیست بکاپ‌ها
- `cleanup_old_backups(days)`: حذف بکاپ‌های قدیمی

### بکاپ خودکار
بکاپ خودکار در این routeها فعال است:
- `/project/<id>/delete` - قبل از حذف پروژه
- `/project/<id>/batch_edit` - قبل از ویرایش گروهی
- `/inventory/items/remove/<id>` - قبل از کسر انبار

---

## ✅ چک‌لیست روزانه

- [ ] آیا امروز بکاپ گرفته‌اید؟
- [ ] آیا بکاپ‌های قدیمی را پاک کرده‌اید؟
- [ ] آیا یک نسخه بکاپ در جای دیگری دارید؟ (USB, Google Drive)

---

**نکته طلایی:** همیشه قبل از کارهای بزرگ، یک بکاپ بگیرید! 🎯
